<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css" media="all">
    <link rel="stylesheet" type="text/css" href="css/bootstrap-responsive.min.css" media="all">
    <link rel="stylesheet" type="text/css" href="css/styles.css" media="all">
    <title>SWN Artist Browser</title>

    <script type="text/javascript" src="//platform.twitter.com/widgets.js"></script>
</head>
    <body>

        <div class="container-fluid">
            <div class="well">
                <h1>SWN Artist Explorer</h1>
            </div>
        </div>

        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span4">
                    <div id="band_list" style="height: 750px; overflow:auto;">
                        <div id="days_accordion" class="accordion">
                            <div class="accordion-group">
                                <header class="accordion-heading">
                                    <a href="#" data-target="#collapseThurs" data-toggle="collapse" class="accordion-toggle">Thursday</a>
                                </header>
                                <article id="collapseThurs" class="accordion-body collapse">
                                    <div id="thurs" class="accordion-inner"><ul></ul></div>
                                </article>
                            </div>
                            <div class="accordion-group">
                                <header class="accordion-heading">
                                    <a href="#" data-target="#collapseFri" data-toggle="collapse" class="accordion-toggle">Friday</a>
                                </header>
                                <article id="collapseFri" class="accordion-body collapse">
                                    <div id="fri" class="accordion-inner"><ul></ul></div>
                                </article>
                            </div>
                            <div class="accordion-group">
                                <header class="accordion-heading">
                                    <a href="#" data-target="#collapseSat" data-toggle="collapse" class="accordion-toggle">Saturday</a>
                                </header>
                                <article id="collapseSat" class="accordion-body collapse">
                                    <div id="sat" class="accordion-inner"><ul></ul></div>
                                </article>
                            </div>
                            <div class="accordion-group">
                                <header class="accordion-heading">
                                    <a href="#" data-target="#collapseSun" data-toggle="collapse" class="accordion-toggle">Sunday</a>
                                </header>
                                <article id="collapseSun" class="accordion-body collapse">
                                    <div id="sun" class="accordion-inner"><ul></ul></div>
                                </article>
                            </div>
                        </div>
                    </div>

                </div>
                <div id="holder" class="span8">
                    <div id="vis"></div>
                </div>
            </div>
        </div>

        <footer class="container-fluid">
                <small>hacked together by <a href="https://twitter.com/intent/user?screen_name=martinjc">@martinjc</a> on a mildly boring saturday in September</small>
        </footer>


        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script src="http://d3js.org/d3.v2.min.js"></script>
        <script src="js/d3.layout.cloud.js"></script>
        <script src="js/cloud.js"></script>
        <script>
            var band_data;

            var selected_artist;

            var selected_day;

            function show_info(name) {
                $('.accordion-inner > ul > li').show(400);
                $('.selected').removeClass('selected');
                $('#' + name).addClass('selected');
            }

            function show_similar(tag) {
                $('.accordion-inner > ul > li').show(400);
                selected_day = $('.collapse.in').attr('id');
                $('.collapse').collapse('show');
                for(var i in band_data) {
                    var bands = band_data[i].bands;
                    for(var j in bands) {
                        var band_tags = Object.keys(bands[j].tags);
                        var has_tag = false;
                        for(var k in band_tags) {
                            if(band_tags[k] === tag) {
                                has_tag = true;
                            }
                        }
                        if(!has_tag) {
                            $('#' + bands[j].artist_name).hide(400);
                        }
                    }
                }
            }

            $(document).ready(function() {

                $('#collapseSat').collapse('show');

                w = $('#vis').width();
                h = $('#vis').height();

                function select_band(band, band_tags) {
                    parseText(band_tags);
                }

                $.getJSON('data/bands.json', function(data){
                    band_data = data;
                    for(var i in band_data) {
                        var day = band_data[i].day;
                        var bands = band_data[i].bands;
                        for(var j in bands) {
                            $('#' + day + ' > ul').append('<li id="' + bands[j].artist_name + '">'+ bands[j].artist +'</li>')
                            if(!($.isEmptyObject(bands[j].tags))) {
                                $('#' + bands[j].artist_name).addClass('clickable');
                                (function(b) {
                                    $('#' + bands[j].artist_name).on('click', function() {
                                        selected_artist = b.artist_name;
                                        show_info(b.artist_name);
                                        parseText(b.tags);
                                    });
                                })(bands[j]);
                            }
                        }
                    }
                });

                $(window).resize(function() {
                    w = $('#vis').width();
                    h = $('#vis').height();
                    generate();
                });
            });
        </script>

    </body>
</html>
